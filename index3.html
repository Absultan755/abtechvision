<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AB TECHVISION - MCQ Collection</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light gray background */
        }
        .section {
            display: none; /* Hidden by default */
        }
        .section.active {
            display: block; /* Show active section */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        .option-button {
            @apply bg-blue-100 text-blue-800 py-2 px-4 rounded-md text-left w-full hover:bg-blue-200 transition duration-200 ease-in-out mb-2;
        }
        .option-button.correct {
            @apply bg-green-200 text-green-800;
        }
        .option-button.incorrect {
            @apply bg-red-200 text-red-800;
        }
        ::-webkit-scrollbar-thumb {
            background: #60a5fa;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3b82f6;
        }
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #3b82f6;
        }
    </style>
</head>
<body class="text-gray-800">
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg p-4 sticky top-0 z-50">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl md:text-4xl font-extrabold text-white tracking-wide mb-2 md:mb-0">AB Techvision</h1>
            <nav>
                <ul class="flex space-x-4 md:space-x-8">
                    <li><a href="#home" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="home">Home</a></li>
                    <li><a href="#subjects" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="subjects">Subjects</a></li>
                    <li><a href="#blog" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="blog">Blog</a></li>
                    <li><a href="#past-papers-section" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="past-papers-section">Past Papers</a></li>
                    <li><a href="#contact" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="contact">Contact</a></li>
                    <li><a href="#about" class="nav-link text-lg hover:text-blue-200 transition duration-300 ease-in-out px-3 py-2 rounded-md" data-target="about">About Us</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main class="container mx-auto p-6 lg:p-10">
        <section id="home" class="section active bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="text-center py-16">
                <h2 class="text-5xl font-extrabold text-blue-700 mb-6 leading-tight">Empowering Minds with Knowledge</h2>
                <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
                    AB TECHVISION is your ultimate destination for comprehensive Multiple Choice Questions (MCQs) designed for students and teachers. Prepare for exams, enhance your knowledge, and master any subject with our vast collection.
                </p>
                <a href="#subjects" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out">
                    Start Practicing MCQs
                </a>
            </div>
        </section>
        <section id="blog" class="section bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">Our Blog</h2>
            <!-- Add New Blog Post Form -->
            <div id="add-edit-blog-section" class="bg-blue-50 p-6 rounded-lg shadow-md mb-8">
                <h3 id="blog-form-title" class="text-2xl font-semibold text-blue-700 mb-4">Add a New Blog Post</h3>
                <form id="add-blog-form">
                    <div class="mb-4">
                        <label for="blog-title" class="block text-gray-700 text-sm font-bold mb-2">Blog Title:</label>
                        <input type="text" id="blog-title" name="title" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter blog post title" required>
                    </div>
                    <div class="mb-4">
                        <label for="blog-content" class="block text-gray-700 text-sm font-bold mb-2">Blog Content:</label>
                        <textarea id="blog-content" name="content" rows="8" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Write your blog post here..." required></textarea>
                    </div>
                    <button type="submit" id="submit-blog-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                        Add Blog Post
                    </button>
                    <button type="button" id="cancel-blog-edit-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out ml-4 hidden">
                        Cancel Edit
                    </button>
                </form>
            </div>
            <div id="blog-posts-display" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Blog posts will be rendered here -->
            </div>
        </section>
        <section id="past-papers-section" class="section bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">Past Papers</h2>
            <!-- List View for Past Paper Categories -->
            <div id="past-papers-list-view">
                <div id="add-past-paper-category-section" class="bg-green-50 p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-2xl font-semibold text-green-700 mb-4">Add New Past Paper Category</h3>
                    <form id="add-past-paper-category-form">
                        <div class="mb-4">
                            <label for="new-past-paper-category-name" class="block text-gray-700 text-sm font-bold mb-2">Category Name (e.g., FPSC, KPPSC):</label>
                            <input type="text" id="new-past-paper-category-name" name="categoryName" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="e.g., FPSC, KPPSC" required>
                        </div>
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                            Add Category
                        </button>
                    </form>
                </div>
                <div id="past-papers-categories-display" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Past Paper Category cards will be rendered here -->
                </div>
            </div>
            <!-- Detail View for Selected Past Paper Category -->
            <div id="past-paper-detail-view" class="hidden">
                <button id="back-to-past-papers-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full mb-6 transform hover:scale-105 transition duration-300 ease-in-out">
                    &larr; Back to Categories
                </button>
                <h3 id="current-past-paper-title" class="text-3xl font-bold text-blue-700 mb-6 text-center"></h3>
                <!-- Form to Add PDF/Image -->
                <div id="add-edit-pdf-image-section" class="bg-green-50 p-6 rounded-lg shadow-md mb-8">
                    <h4 id="pdf-image-form-title" class="text-2xl font-semibold text-green-700 mb-4">Add New PDF or Image</h4>
                    <form id="add-pdf-image-form">
                        <div class="mb-4">
                            <label for="pdf-image-name" class="block text-gray-700 text-sm font-bold mb-2">Name (e.g., 2023 General Paper):</label>
                            <input type="text" id="pdf-image-name" name="name" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="e.g., 2023 General Paper" required>
                        </div>
                        <div class="mb-4">
                            <label for="pdf-image-file" class="block text-gray-700 text-sm font-bold mb-2">Upload File (PDF or Image):</label>
                            <input type="file" id="pdf-image-file" name="file" accept=".pdf,image/*" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500">
                            <p class="text-sm text-gray-500 mt-1">Or provide a direct URL:</p>
                        </div>
                        <div class="mb-4">
                            <label for="pdf-image-url" class="block text-gray-700 text-sm font-bold mb-2">External URL (optional):</label>
                            <input type="url" id="pdf-image-url" name="url" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="e.g., https://example.com/paper.pdf">
                        </div>
                        <div class="mb-6">
                            <label for="pdf-image-type" class="block text-gray-700 text-sm font-bold mb-2">Type:</label>
                            <select id="pdf-image-type" name="type" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">Select Type</option>
                                <option value="pdf">PDF</option>
                                <option value="image">Image</option>
                            </select>
                        </div>
                        <button type="submit" id="submit-pdf-image-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                            Add Item
                        </button>
                        <button type="button" id="cancel-pdf-image-edit-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out ml-4 hidden">
                            Cancel Edit
                        </button>
                    </form>
                    <p class="text-red-500 text-sm mt-4">
                        <strong>Note:</strong> Files uploaded here will be stored in Supabase Storage. Providing an external URL is also an option.
                    </p>
                </div>
                <!-- Display PDF/Image List -->
                <div id="pdf-image-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- PDF and Image items will be rendered here -->
                </div>
            </div>
        </section>
        <section id="subjects" class="section bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">Explore Our Subjects</h2>
            <div id="loading-indicator" class="text-center text-blue-600 text-xl font-semibold py-8">
                Loading Subjects...
            </div>
            <!-- Section for displaying subjects -->
            <div id="subjects-list-view">
                <div id="subjects-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Subject cards will be rendered here -->
                </div>
                <!-- Form to add new subject -->
                <div id="add-subject-section" class="bg-blue-50 p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold text-blue-700 mb-4">Add a New Subject</h3>
                    <form id="add-subject-form">
                        <div class="mb-4">
                            <label for="new-subject-name" class="block text-gray-700 text-sm font-bold mb-2">Subject Name:</label>
                            <input type="text" id="new-subject-name" name="subjectName" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Physics, Chemistry" required>
                        </div>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                            Add Subject
                        </button>
                    </form>
                </div>
            </div>
            <!-- Section for displaying MCQs of a selected subject -->
            <div id="subject-detail-view" class="hidden">
                <button id="back-to-subjects-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full mb-6 transform hover:scale-105 transition duration-300 ease-in-out">
                    &larr; Back to Subjects
                </button>
                <h3 id="current-subject-title" class="text-3xl font-bold text-blue-700 mb-6 text-center"></h3>
                <div id="quiz-controls" class="text-center mb-8">
                    <button id="start-quiz-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out mr-4">
                        Start Quiz for this Subject
                    </button>
                </div>
                <!-- Add New MCQ Form (reused) -->
                <div id="add-edit-mcq-section" class="bg-blue-50 p-6 rounded-lg shadow-md mb-8">
                    <h3 id="mcq-form-title" class="text-2xl font-semibold text-blue-700 mb-4">Add a New MCQ</h3>
                    <form id="add-mcq-form">
                        <!-- Subject input removed as it will be implicitly set -->
                        <div class="mb-4">
                            <label for="mcq-question" class="block text-gray-700 text-sm font-bold mb-2">Question:</label>
                            <textarea id="mcq-question" name="question" rows="3" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter the MCQ question" required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="mcq-options" class="block text-gray-700 text-sm font-bold mb-2">Options (comma-separated):</label>
                            <input type="text" id="mcq-options" name="options" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Option A, Option B, Option C, Option D" required>
                        </div>
                        <div class="mb-6">
                            <label for="mcq-answer" class="block text-gray-700 text-sm font-bold mb-2">Correct Answer (exactly as in options):</label>
                            <input type="text" id="mcq-answer" name="answer" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Option B" required>
                        </div>
                        <button type="submit" id="submit-mcq-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                            Add MCQ
                        </button>
                        <button type="button" id="cancel-edit-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out ml-4 hidden">
                            Cancel Edit
                        </button>
                    </form>
                </div>
                <div id="mcqs-display" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- MCQs for the selected subject will be rendered here -->
                </div>
            </div>
            <div id="quiz-section" class="hidden bg-blue-50 p-8 rounded-xl shadow-lg">
                <h3 class="text-3xl font-bold text-blue-700 mb-6 text-center">Quiz Time!</h3>
                <div id="quiz-question-container" class="mb-6">
                    <p id="quiz-question" class="text-2xl font-semibold text-gray-800 mb-4"></p>
                    <div id="quiz-options" class="flex flex-col space-y-3"></div>
                </div>
                <div id="quiz-feedback" class="mt-4 text-center text-lg font-bold"></div>
                <div class="flex justify-between items-center mt-8">
                    <button id="prev-question-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full transform hover:scale-105 transition duration-300 ease-in-out">
                        Previous
                    </button>
                    <button id="next-question-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full transform hover:scale-105 transition duration-300 ease-in-out">
                        Next
                    </button>
                </div>
                <div id="quiz-result" class="text-center mt-8 text-3xl font-bold text-blue-700 hidden"></div>
                <div class="text-center mt-8">
                    <button id="quiz-back-to-subject-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-300 ease-in-out hidden">
                        Back to Subject MCQs
                    </button>
                </div>
            </div>
        </section>
        <section id="contact" class="section bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">Get in Touch</h2>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="p-6 bg-blue-50 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold text-blue-700 mb-4">Contact Information</h3>
                    <p class="text-gray-600 mb-2"><span class="font-medium">Email:</span> info@abtechvision.com</p>
                    <p class="text-gray-600 mb-2"><span class="font-medium">Phone:</span> +1 (123) 456-7890</p>
                    <p class="text-gray-600 mb-2"><span class="font-medium">Address:</span> 123 MCQ Lane, Knowledge City, World</p>
                    <div class="mt-6">
                        <h4 class="text-xl font-semibold text-blue-700 mb-3">Follow Us:</h4>
                        <div class="flex space-x-4">
                            <a href="#" class="text-blue-600 hover:text-blue-800 transition duration-300 ease-in-out">Facebook</a>
                            <a href="#" class="text-blue-600 hover:text-blue-800 transition duration-300 ease-in-out">Twitter</a>
                            <a href="#" class="text-blue-600 hover:text-blue-800 transition duration-300 ease-in-out">LinkedIn</a>
                        </div>
                    </div>
                </div>
                <div class="p-6 bg-blue-50 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold text-blue-700 mb-4">Send Us a Message</h3>
                    <form>
                        <div class="mb-4">
                            <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Name:</label>
                            <input type="text" id="name" name="name" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your Name">
                        </div>
                        <div class="mb-4">
                            <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                            <input type="email" id="email" name="email" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="your@example.com">
                        </div>
                        <div class="mb-6">
                            <label for="message" class="block text-gray-700 text-sm font-bold mb-2">Message:</label>
                            <textarea id="message" name="message" rows="5" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your message..."></textarea>
                        </div>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300 ease-in-out">
                            Send Message
                        </button>
                    </form>
                </div>
            </div>
        </section>
        <section id="about" class="section bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">About AB TECHVISION</h2>
            <div class="text-lg text-gray-700 leading-relaxed">
                <p class="mb-6">
                    AB TECHVISION was founded with a clear mission: to revolutionize the way students learn and teachers teach through the power of Multiple Choice Questions. We understand the critical role MCQs play in modern education, from reinforcing concepts to preparing for competitive exams.
                </p>
                <p class="mb-6">
                    Our platform is meticulously designed to cater to a diverse audience, including students from various academic levels seeking to solidify their understanding, and teachers looking for efficient tools to assess and engage their pupils. We believe that learning should be accessible, engaging, and effective.
                </p>
                <p class="mb-6">
                    We offer a vast and ever-expanding library of MCQs across a multitude of subjects, ensuring that every user finds relevant and challenging content. Beyond just questions, AB TECHVISION provides detailed explanations, performance tracking, and a user-friendly interface to make the learning journey seamless and rewarding.
                </p>
                <p class="mb-6">
                    Our commitment extends to supporting educators by providing robust features like custom quiz creation, class management, and insightful analytics, empowering them to deliver high-quality instruction and personalized feedback.
                </p>
                <p>
                    Join AB TECHVISION today and embark on a journey of knowledge, mastery, and academic excellence. We are dedicated to being your trusted partner in education.
                </p>
            </div>
        </section>
    </main>
    <footer class="bg-gray-800 text-white p-6 text-center rounded-t-xl shadow-inner mt-8">
        <div class="container mx-auto">
            <p>&copy; 2025 AB TECHVISION. All rights reserved.</p>
            <div class="flex justify-center space-x-4 mt-2">
                <a href="#" class="hover:text-blue-400 transition duration-300 ease-in-out">Privacy Policy</a>
                <a href="#" class="hover:text-blue-400 transition duration-300 ease-in-out">Terms of Service</a>
            </div>
        </div>
    </footer>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-message" class="text-lg text-gray-700"></p>
            <div id="modal-actions" class="mt-4 hidden">
                <button id="modal-confirm-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full mr-2">Confirm</button>
                <button id="modal-cancel-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-full">Cancel</button>
            </div>
        </div>
    </div>
    <div id="loading-overlay" class="loading-overlay">
        <p>Loading...</p>
    </div>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // --- Supabase Configuration ---
        // **IMPORTANT:** Replace these with your actual Supabase project URL and public key.
        const SUPABASE_URL = 'https://aksgzmjuduqerdeueeix.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrc2d6bWp1ZHVxZXJkZXVlZWl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NTUyNTIsImV4cCI6MjA3MDAzMTI1Mn0.Pq6KfzfInM_GrQKYE8qBfG4jySjMHGV_m3_AsAgCAiA';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- Global State Variables ---
        let allSubjectsData = [];
        let allBlogPosts = [];
        let allPastPapersData = [];

        let currentSelectedSubject = null;
        let currentQuizMcqs = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;

        let editingMcqId = null;
        let editingBlogPostId = null;
        let currentSelectedPastPaperCategory = null;
        let editingPdfImageId = null;

        // --- DOM Elements ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const subjectsListDiv = document.getElementById('subjects-list');
        const loadingIndicator = document.getElementById('loading-indicator');
        const subjectsListView = document.getElementById('subjects-list-view');
        const addSubjectForm = document.getElementById('add-subject-form');
        const subjectDetailView = document.getElementById('subject-detail-view');
        const backToSubjectsBtn = document.getElementById('back-to-subjects-btn');
        const currentSubjectTitle = document.getElementById('current-subject-title');
        const addMcqForm = document.getElementById('add-mcq-form');
        const mcqsDisplay = document.getElementById('mcqs-display');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizSection = document.getElementById('quiz-section');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.getElementById('quiz-options');
        const quizFeedback = document.getElementById('quiz-feedback');
        const prevQuestionBtn = document.getElementById('prev-question-btn');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const quizResult = document.getElementById('quiz-result');
        const quizBackToSubjectBtn = document.getElementById('quiz-back-to-subject-btn');

        const blogPostsDisplay = document.getElementById('blog-posts-display');
        const addBlogForm = document.getElementById('add-blog-form');
        const blogTitleInput = document.getElementById('blog-title');
        const blogContentInput = document.getElementById('blog-content');
        const submitBlogBtn = document.getElementById('submit-blog-btn');
        const cancelBlogEditBtn = document.getElementById('cancel-blog-edit-btn');
        const blogFormTitle = document.getElementById('blog-form-title');

        const pastPapersListView = document.getElementById('past-papers-list-view');
        const pastPapersCategoriesDisplay = document.getElementById('past-papers-categories-display');
        const addPastPaperCategoryForm = document.getElementById('add-past-paper-category-form');
        const pastPaperDetailView = document.getElementById('past-paper-detail-view');
        const backToPastPapersBtn = document.getElementById('back-to-past-papers-btn');
        const currentPastPaperTitle = document.getElementById('current-past-paper-title');
        const addPdfImageForm = document.getElementById('add-pdf-image-form');
        const pdfImageDisplay = document.getElementById('pdf-image-display');
        const pdfImageFile = document.getElementById('pdf-image-file');
        const pdfImageUrl = document.getElementById('pdf-image-url');
        const submitPdfImageBtn = document.getElementById('submit-pdf-image-btn');
        const cancelPdfImageEditBtn = document.getElementById('cancel-pdf-image-edit-btn');
        const pdfImageFormTitle = document.getElementById('pdf-image-form-title');

        const modal = document.getElementById('myModal');
        const modalMessage = document.getElementById('modal-message');
        const closeModal = document.querySelector('#myModal .close-button');
        const modalActions = document.getElementById('modal-actions');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const loadingOverlay = document.getElementById('loading-overlay');

        // --- Utility Functions ---

        // Function to show a custom modal instead of alert/confirm
        function showModal(message, isConfirmation = false, onConfirm = null) {
            modalMessage.textContent = message;
            modalActions.classList.toggle('hidden', !isConfirmation);
            if (isConfirmation && onConfirm) {
                modalConfirmBtn.onclick = () => {
                    modal.style.display = 'none';
                    onConfirm();
                };
            }
            modal.style.display = 'flex';
        }

        // Close modal event listener
        closeModal.onclick = () => {
            modal.style.display = 'none';
        };
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };
        // Reset modal actions
        modalCancelBtn.onclick = () => modal.style.display = 'none';

        // Function to show/hide loading overlay
        function showLoading(show) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }

        function showSection(target) {
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === target) {
                    section.classList.add('active');
                }
            });
            navLinks.forEach(link => {
                link.classList.remove('font-bold', 'bg-blue-700');
                if (link.getAttribute('data-target') === target) {
                    link.classList.add('font-bold', 'bg-blue-700');
                }
            });
        }

        // --- Supabase Data Handlers ---

        async function fetchSubjects() {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('subjects')
                    .select('*');
                if (error) throw error;
                allSubjectsData = data;
                renderSubjects(allSubjectsData);
            } catch (error) {
                console.error('Error fetching subjects:', error.message);
                showModal('Error fetching subjects: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function addSubject(subjectName) {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('subjects')
                    .insert([{ name: subjectName }]);
                if (error) throw error;
                showModal('Subject added successfully!');
                fetchSubjects(); // Refresh the list
                addSubjectForm.reset();
            } catch (error) {
                console.error('Error adding subject:', error.message);
                showModal('Error adding subject: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function fetchMcqsForSubject(subjectId) {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('mcqs')
                    .select('*')
                    .eq('subject_id', subjectId);
                if (error) throw error;
                renderMcqs(data);
                currentQuizMcqs = data; // Store for quiz
            } catch (error) {
                console.error('Error fetching MCQs:', error.message);
                showModal('Error fetching MCQs: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function addMcq(question, options, answer, subjectId) {
            showLoading(true);
            try {
                const optionsArray = options.split(',').map(opt => opt.trim());
                const { data, error } = await supabase
                    .from('mcqs')
                    .insert([{ question, options: optionsArray, answer, subject_id: subjectId }]);
                if (error) throw error;
                showModal('MCQ added successfully!');
                fetchMcqsForSubject(subjectId);
                addMcqForm.reset();
            } catch (error) {
                console.error('Error adding MCQ:', error.message);
                showModal('Error adding MCQ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function updateMcq(id, question, options, answer) {
            showLoading(true);
            try {
                const optionsArray = options.split(',').map(opt => opt.trim());
                const { data, error } = await supabase
                    .from('mcqs')
                    .update({ question, options: optionsArray, answer })
                    .eq('id', id);
                if (error) throw error;
                showModal('MCQ updated successfully!');
                fetchMcqsForSubject(currentSelectedSubject);
                addMcqForm.reset();
                editingMcqId = null;
                submitMcqBtn.textContent = 'Add MCQ';
                mcqFormTitle.textContent = 'Add a New MCQ';
                cancelEditBtn.classList.add('hidden');
            } catch (error) {
                console.error('Error updating MCQ:', error.message);
                showModal('Error updating MCQ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function deleteMcq(id) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('mcqs')
                    .delete()
                    .eq('id', id);
                if (error) throw error;
                showModal('MCQ deleted successfully!');
                fetchMcqsForSubject(currentSelectedSubject);
            } catch (error) {
                console.error('Error deleting MCQ:', error.message);
                showModal('Error deleting MCQ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function fetchBlogPosts() {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('blog_posts')
                    .select('*')
                    .order('created_at', { ascending: false });
                if (error) throw error;
                allBlogPosts = data;
                renderBlogPosts(allBlogPosts);
            } catch (error) {
                console.error('Error fetching blog posts:', error.message);
                showModal('Error fetching blog posts: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function addBlogPost(title, content) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('blog_posts')
                    .insert([{ title, content }]);
                if (error) throw error;
                showModal('Blog post added successfully!');
                fetchBlogPosts();
                addBlogForm.reset();
            } catch (error) {
                console.error('Error adding blog post:', error.message);
                showModal('Error adding blog post: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function updateBlogPost(id, title, content) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('blog_posts')
                    .update({ title, content })
                    .eq('id', id);
                if (error) throw error;
                showModal('Blog post updated successfully!');
                fetchBlogPosts();
                addBlogForm.reset();
                editingBlogPostId = null;
                submitBlogBtn.textContent = 'Add Blog Post';
                blogFormTitle.textContent = 'Add a New Blog Post';
                cancelBlogEditBtn.classList.add('hidden');
            } catch (error) {
                console.error('Error updating blog post:', error.message);
                showModal('Error updating blog post: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function deleteBlogPost(id) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('blog_posts')
                    .delete()
                    .eq('id', id);
                if (error) throw error;
                showModal('Blog post deleted successfully!');
                fetchBlogPosts();
            } catch (error) {
                console.error('Error deleting blog post:', error.message);
                showModal('Error deleting blog post: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function fetchPastPaperCategories() {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('past_paper_categories')
                    .select('*');
                if (error) throw error;
                allPastPapersData = data;
                renderPastPaperCategories(allPastPapersData);
            } catch (error) {
                console.error('Error fetching past paper categories:', error.message);
                showModal('Error fetching past paper categories: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function addPastPaperCategory(name) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('past_paper_categories')
                    .insert([{ name }]);
                if (error) throw error;
                showModal('Category added successfully!');
                fetchPastPaperCategories();
                addPastPaperCategoryForm.reset();
            } catch (error) {
                console.error('Error adding category:', error.message);
                showModal('Error adding category: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function deletePastPaperCategory(id) {
            showLoading(true);
            try {
                // Delete all associated past paper items first
                await supabase.from('past_paper_items').delete().eq('category_id', id);

                const { error } = await supabase
                    .from('past_paper_categories')
                    .delete()
                    .eq('id', id);
                if (error) throw error;
                showModal('Category and associated papers deleted successfully!');
                fetchPastPaperCategories();
            } catch (error) {
                console.error('Error deleting category:', error.message);
                showModal('Error deleting category: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function fetchPastPaperItems(categoryId) {
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('past_paper_items')
                    .select('*')
                    .eq('category_id', categoryId);
                if (error) throw error;
                renderPastPaperItems(data);
            } catch (error) {
                console.error('Error fetching past paper items:', error.message);
                showModal('Error fetching past paper items: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function addPdfImage(name, file, url, type, categoryId) {
            showLoading(true);
            try {
                let publicUrl = url;
                if (file) {
                    const filePath = `${categoryId}/${file.name}-${Date.now()}`;
                    const { data, error } = await supabase.storage.from('past-papers').upload(filePath, file);
                    if (error) throw error;
                    publicUrl = supabase.storage.from('past-papers').getPublicUrl(filePath).data.publicUrl;
                }

                if (!publicUrl) {
                    throw new Error('Please provide a file or a URL.');
                }

                const { error: insertError } = await supabase
                    .from('past_paper_items')
                    .insert([{ name, type, url: publicUrl, category_id: categoryId }]);
                if (insertError) throw insertError;

                showModal('Item added successfully!');
                fetchPastPaperItems(categoryId);
                addPdfImageForm.reset();
            } catch (error) {
                console.error('Error adding PDF/Image:', error.message);
                showModal('Error adding PDF/Image: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function deletePdfImage(id) {
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('past_paper_items')
                    .delete()
                    .eq('id', id);
                if (error) throw error;
                showModal('Item deleted successfully!');
                fetchPastPaperItems(currentSelectedPastPaperCategory);
            } catch (error) {
                console.error('Error deleting PDF/Image:', error.message);
                showModal('Error deleting PDF/Image: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // --- Rendering Functions ---

        function renderSubjects(subjects) {
            subjectsListDiv.innerHTML = '';
            if (subjects.length === 0) {
                subjectsListDiv.innerHTML = '<p class="text-center text-gray-500 col-span-3">No subjects found. Add a new one above!</p>';
                return;
            }
            subjects.forEach(subject => {
                const subjectCard = document.createElement('div');
                subjectCard.className = 'bg-blue-100 rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-200 ease-in-out cursor-pointer flex flex-col justify-between items-center';
                subjectCard.innerHTML = `
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">${subject.name}</h3>
                    <div class="flex space-x-2">
                        <button class="view-subject-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-colors duration-200" data-id="${subject.id}" data-name="${subject.name}">
                            View MCQs
                        </button>
                    </div>
                `;
                subjectsListDiv.appendChild(subjectCard);
            });
        }

        function renderMcqs(mcqs) {
            mcqsDisplay.innerHTML = '';
            if (mcqs.length === 0) {
                mcqsDisplay.innerHTML = '<p class="text-center text-gray-500 col-span-3">No MCQs found for this subject. Add a new one above!</p>';
                return;
            }
            mcqs.forEach(mcq => {
                const mcqCard = document.createElement('div');
                mcqCard.className = 'bg-gray-100 rounded-xl shadow-md p-6';
                mcqCard.innerHTML = `
                    <p class="text-lg font-semibold mb-2">${mcq.question}</p>
                    <ul class="list-disc list-inside text-gray-700">
                        ${mcq.options.map(opt => `<li>${opt}</li>`).join('')}
                    </ul>
                    <p class="mt-4 font-medium text-green-700">Answer: ${mcq.answer}</p>
                    <div class="mt-4 flex space-x-2">
                        <button class="edit-mcq-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${mcq.id}" data-question="${mcq.question}" data-options="${mcq.options.join(',')}" data-answer="${mcq.answer}">Edit</button>
                        <button class="delete-mcq-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${mcq.id}">Delete</button>
                    </div>
                `;
                mcqsDisplay.appendChild(mcqCard);
            });
        }

        function renderBlogPosts(posts) {
            blogPostsDisplay.innerHTML = '';
            if (posts.length === 0) {
                blogPostsDisplay.innerHTML = '<p class="text-center text-gray-500 col-span-3">No blog posts found. Add a new one above!</p>';
                return;
            }
            posts.forEach(post => {
                const postCard = document.createElement('div');
                postCard.className = 'bg-gray-100 rounded-xl shadow-md p-6 flex flex-col justify-between';
                postCard.innerHTML = `
                    <div>
                        <h3 class="text-2xl font-bold text-blue-700 mb-2">${post.title}</h3>
                        <p class="text-gray-700 mb-4 overflow-hidden" style="display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical;">
                            ${post.content}
                        </p>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="edit-blog-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${post.id}">Edit</button>
                        <button class="delete-blog-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${post.id}">Delete</button>
                    </div>
                `;
                blogPostsDisplay.appendChild(postCard);
            });
        }

        function renderPastPaperCategories(categories) {
            pastPapersCategoriesDisplay.innerHTML = '';
            if (categories.length === 0) {
                pastPapersCategoriesDisplay.innerHTML = '<p class="text-center text-gray-500 col-span-4">No categories found. Add a new one above!</p>';
                return;
            }
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md p-6 transform transition-transform hover:scale-105 duration-200 ease-in-out flex flex-col justify-between items-center';
                card.innerHTML = `
                    <h3 class="text-xl font-semibold text-green-700 mb-4">${category.name}</h3>
                    <div class="flex space-x-2">
                        <button class="view-category-btn bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${category.id}" data-name="${category.name}">View Papers</button>
                        <button class="delete-category-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${category.id}">Delete</button>
                    </div>
                `;
                pastPapersCategoriesDisplay.appendChild(card);
            });
        }

        function renderPastPaperItems(items) {
            pdfImageDisplay.innerHTML = '';
            if (items.length === 0) {
                pdfImageDisplay.innerHTML = '<p class="text-center text-gray-500 col-span-3">No papers found for this category. Add a new one above!</p>';
                return;
            }
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-gray-100 rounded-xl shadow-md p-6 flex flex-col justify-between';
                let contentHtml;
                if (item.type === 'pdf') {
                    contentHtml = `<a href="${item.url}" target="_blank" class="text-blue-600 hover:underline">View PDF</a>`;
                } else if (item.type === 'image') {
                    contentHtml = `<img src="${item.url}" alt="${item.name}" class="rounded-lg mb-2 w-full h-48 object-cover">`;
                }
                card.innerHTML = `
                    <div>
                        <h4 class="text-lg font-bold mb-2">${item.name}</h4>
                        ${contentHtml}
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button class="delete-pdf-image-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-id="${item.id}">Delete</button>
                    </div>
                `;
                pdfImageDisplay.appendChild(card);
            });
        }

        function renderQuizQuestion() {
            if (currentQuizMcqs.length === 0) {
                quizQuestion.textContent = 'No MCQs available to quiz.';
                quizOptions.innerHTML = '';
                prevQuestionBtn.classList.add('hidden');
                nextQuestionBtn.classList.add('hidden');
                quizBackToSubjectBtn.classList.remove('hidden');
                return;
            }
            const currentMcq = currentQuizMcqs[currentQuestionIndex];
            quizQuestion.textContent = `Question ${currentQuestionIndex + 1}: ${currentMcq.question}`;
            quizOptions.innerHTML = '';
            currentMcq.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.textContent = option;
                optionButton.className = 'option-button';
                optionButton.dataset.option = option;
                optionButton.disabled = currentMcq.userAnswer !== undefined; // Disable if already answered
                optionButton.addEventListener('click', () => {
                    handleQuizAnswer(option, currentMcq);
                });
                quizOptions.appendChild(optionButton);
            });
            updateQuizNavigation();
        }

        function handleQuizAnswer(selectedOption, mcq) {
            if (mcq.userAnswer) return; // Prevent re-answering
            mcq.userAnswer = selectedOption;
            const optionsButtons = quizOptions.querySelectorAll('.option-button');
            optionsButtons.forEach(button => {
                button.disabled = true;
                if (button.dataset.option === mcq.answer) {
                    button.classList.add('correct');
                } else if (button.dataset.option === selectedOption) {
                    button.classList.add('incorrect');
                }
            });
            if (selectedOption === mcq.answer) {
                quizFeedback.textContent = 'Correct!';
                quizFeedback.className = 'mt-4 text-center text-lg font-bold text-green-600';
            } else {
                quizFeedback.textContent = `Incorrect. The correct answer was "${mcq.answer}".`;
                quizFeedback.className = 'mt-4 text-center text-lg font-bold text-red-600';
            }
            updateQuizNavigation();
        }

        function updateQuizNavigation() {
            prevQuestionBtn.classList.toggle('hidden', currentQuestionIndex === 0);
            nextQuestionBtn.classList.toggle('hidden', currentQuestionIndex === currentQuizMcqs.length - 1);
            if (currentQuestionIndex === currentQuizMcqs.length - 1 && currentQuizMcqs.every(q => q.userAnswer)) {
                nextQuestionBtn.textContent = 'Finish Quiz';
                nextQuestionBtn.onclick = showQuizResult;
            } else {
                nextQuestionBtn.textContent = 'Next';
                nextQuestionBtn.onclick = () => {
                    currentQuestionIndex++;
                    renderQuizQuestion();
                    quizFeedback.textContent = ''; // Clear feedback for new question
                };
            }
        }

        function showQuizResult() {
            quizScore = currentQuizMcqs.filter(q => q.userAnswer === q.answer).length;
            quizResult.textContent = `You scored ${quizScore} out of ${currentQuizMcqs.length}!`;
            quizResult.classList.remove('hidden');
            prevQuestionBtn.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            quizBackToSubjectBtn.classList.remove('hidden');
        }

        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            fetchSubjects();
            fetchBlogPosts();
            fetchPastPaperCategories();
        });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.target.getAttribute('data-target');
                showSection(target);
                // Refresh content when a section is navigated to
                if (target === 'subjects') {
                    fetchSubjects();
                } else if (target === 'blog') {
                    fetchBlogPosts();
                } else if (target === 'past-papers-section') {
                    fetchPastPaperCategories();
                }
            });
        });

        // Subject Section
        subjectsListDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-subject-btn')) {
                currentSelectedSubject = e.target.dataset.id;
                const subjectName = e.target.dataset.name;
                currentSubjectTitle.textContent = subjectName;
                subjectsListView.classList.add('hidden');
                subjectDetailView.classList.remove('hidden');
                fetchMcqsForSubject(currentSelectedSubject);
            }
        });

        backToSubjectsBtn.addEventListener('click', () => {
            currentSelectedSubject = null;
            subjectsListView.classList.remove('hidden');
            subjectDetailView.classList.add('hidden');
            addMcqForm.reset();
            editingMcqId = null;
            submitMcqBtn.textContent = 'Add MCQ';
            mcqFormTitle.textContent = 'Add a New MCQ';
            cancelEditBtn.classList.add('hidden');
        });

        addSubjectForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const subjectName = document.getElementById('new-subject-name').value;
            addSubject(subjectName);
        });

        // MCQ Section
        addMcqForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const question = document.getElementById('mcq-question').value;
            const options = document.getElementById('mcq-options').value;
            const answer = document.getElementById('mcq-answer').value;

            if (editingMcqId) {
                updateMcq(editingMcqId, question, options, answer);
            } else {
                addMcq(question, options, answer, currentSelectedSubject);
            }
        });

        mcqsDisplay.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-mcq-btn')) {
                const mcqId = e.target.dataset.id;
                showModal('Are you sure you want to delete this MCQ?', true, () => deleteMcq(mcqId));
            } else if (e.target.classList.contains('edit-mcq-btn')) {
                const mcqId = e.target.dataset.id;
                const question = e.target.dataset.question;
                const options = e.target.dataset.options;
                const answer = e.target.dataset.answer;

                document.getElementById('mcq-question').value = question;
                document.getElementById('mcq-options').value = options;
                document.getElementById('mcq-answer').value = answer;

                editingMcqId = mcqId;
                mcqFormTitle.textContent = 'Edit MCQ';
                submitMcqBtn.textContent = 'Save Changes';
                cancelEditBtn.classList.remove('hidden');
            }
        });

        cancelEditBtn.addEventListener('click', () => {
            addMcqForm.reset();
            editingMcqId = null;
            mcqFormTitle.textContent = 'Add a New MCQ';
            submitMcqBtn.textContent = 'Add MCQ';
            cancelEditBtn.classList.add('hidden');
        });

        // Quiz Section
        startQuizBtn.addEventListener('click', () => {
            if (currentQuizMcqs.length > 0) {
                subjectDetailView.classList.add('hidden');
                quizSection.classList.remove('hidden');
                currentQuestionIndex = 0;
                quizScore = 0;
                quizResult.classList.add('hidden');
                quizBackToSubjectBtn.classList.add('hidden');
                currentQuizMcqs.forEach(q => q.userAnswer = undefined);
                renderQuizQuestion();
            } else {
                showModal('There are no MCQs to start a quiz. Please add some first!');
            }
        });

        prevQuestionBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuizQuestion();
                quizFeedback.textContent = '';
            }
        });

        quizBackToSubjectBtn.addEventListener('click', () => {
            quizSection.classList.add('hidden');
            subjectDetailView.classList.remove('hidden');
        });

        // Blog Section
        addBlogForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = blogTitleInput.value;
            const content = blogContentInput.value;
            if (editingBlogPostId) {
                updateBlogPost(editingBlogPostId, title, content);
            } else {
                addBlogPost(title, content);
            }
        });

        blogPostsDisplay.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-blog-btn')) {
                const postId = e.target.dataset.id;
                showModal('Are you sure you want to delete this blog post?', true, () => deleteBlogPost(postId));
            } else if (e.target.classList.contains('edit-blog-btn')) {
                const postId = e.target.dataset.id;
                const post = allBlogPosts.find(p => p.id === postId);
                if (post) {
                    blogTitleInput.value = post.title;
                    blogContentInput.value = post.content;
                    editingBlogPostId = postId;
                    blogFormTitle.textContent = 'Edit Blog Post';
                    submitBlogBtn.textContent = 'Save Changes';
                    cancelBlogEditBtn.classList.remove('hidden');
                }
            }
        });

        cancelBlogEditBtn.addEventListener('click', () => {
            addBlogForm.reset();
            editingBlogPostId = null;
            blogFormTitle.textContent = 'Add a New Blog Post';
            submitBlogBtn.textContent = 'Add Blog Post';
            cancelBlogEditBtn.classList.add('hidden');
        });

        // Past Papers Section
        addPastPaperCategoryForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const categoryName = document.getElementById('new-past-paper-category-name').value;
            addPastPaperCategory(categoryName);
        });

        pastPapersCategoriesDisplay.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-category-btn')) {
                currentSelectedPastPaperCategory = e.target.dataset.id;
                const categoryName = e.target.dataset.name;
                currentPastPaperTitle.textContent = categoryName;
                pastPapersListView.classList.add('hidden');
                pastPaperDetailView.classList.remove('hidden');
                fetchPastPaperItems(currentSelectedPastPaperCategory);
            } else if (e.target.classList.contains('delete-category-btn')) {
                const categoryId = e.target.dataset.id;
                showModal('Are you sure you want to delete this category and all its papers?', true, () => deletePastPaperCategory(categoryId));
            }
        });

        backToPastPapersBtn.addEventListener('click', () => {
            pastPapersListView.classList.remove('hidden');
            pastPaperDetailView.classList.add('hidden');
            currentSelectedPastPaperCategory = null;
        });

        addPdfImageForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('pdf-image-name').value;
            const file = pdfImageFile.files[0];
            const url = pdfImageUrl.value;
            const type = document.getElementById('pdf-image-type').value;

            if (!file && !url) {
                showModal('Please provide either a file to upload or an external URL.');
                return;
            }
            if (file && url) {
                showModal('Please provide either a file OR a URL, not both.');
                return;
            }

            await addPdfImage(name, file, url, type, currentSelectedPastPaperCategory);
        });

        pdfImageDisplay.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-pdf-image-btn')) {
                const itemId = e.target.dataset.id;
                showModal('Are you sure you want to delete this paper?', true, () => deletePdfImage(itemId));
            }
        });

        window.onload = function() {
          // Initialize a default section on load
          showSection('home');
        };

    </script>
</body>
</html>
